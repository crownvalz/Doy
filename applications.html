<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Applications</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
    
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            margin-top: 20px;
        }
        .dataTables_wrapper .dataTables_length,
        .dataTables_wrapper .dataTables_filter {
            margin-bottom: 20px;
        }
        .dataTables_wrapper .dataTables_info {
            margin-top: 10px;
        }
        .btn-view {
            background-color: #17a2b8;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
        }
        .btn-view:hover {
            background-color: #138496;
        }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">My Applications</a>
</nav>

<div class="container">
    <h3 class="text-center">My Applications</h3>

    <table id="applicationsTable" class="display table table-striped table-bordered" style="width:100%">
        <thead>
            <tr>
                <th>Application Status</th>
                <th>Job Title</th>
                <th>Date Applied</th>
                <th>Letter</th>
            </tr>
        </thead>
        <tbody>
            <!-- Dynamic content will be loaded here -->
        </tbody>
    </table>
</div>

<!-- jQuery and Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
<!-- Firebase -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
    import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyBe1HYgEzdcZj0ZOgimd1ODz8B-2aztUYs",
        authDomain: "bank-operations-school.firebaseapp.com",
        projectId: "bank-operations-school",
        storageBucket: "bank-operations-school.appspot.com",
        messagingSenderId: "292213603678",
        appId: "1:292213603678:web:464bf951de870b94baa3cf"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore(app);

    // Load job applications from Firestore
    async function loadApplications(uid) {
        const applicationsTableBody = document.querySelector('#applicationsTable tbody');
        const q = query(collection(db, "applications"), where("userId", "==", uid));
        const querySnapshot = await getDocs(q);
        
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${data.status || 'N/A'}</td>
                <td><strong>Employer:</strong> ${data.employer || 'N/A'} <br><strong>Job Post:</strong> ${data.jobTitle || 'N/A'}</td>
                <td>${data.dateApplied || 'N/A'}</td>
                <td><button class="btn-view">View</button></td>
            `;
            applicationsTableBody.appendChild(row);
        });

        // Initialize DataTables after data load
        $('#applicationsTable').DataTable({
            responsive: true
        });
    }

    // Load user data on page load
    onAuthStateChanged(auth, (user) => {
        if (user) {
            loadApplications(user.uid); // Fetch applications for logged-in user
        } else {
            window.location = "index.html"; // Redirect to login if not logged in
        }
    });
</script>

</body>
</html>